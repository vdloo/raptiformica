{
  "raptiformica_api_version": "0.1",
  "platform": {
    "default": {
      "hooks": {
        "after_mesh": {
          "ensure_second_node": {
            "predicate": "[ $(/usr/bin/consul members | grep alive | wc -l) -lt 3 ]",
            "command": "export PYTHONPATH=.; ./bin/raptiformica_spawn --check-available && ([ ! -f $HOME/.ssh/id_rsa ] && cat /dev/zero | ssh-keygen -q -N '' > /dev/null 2>&1; eval $(ssh-agent -s); ssh-add; ./bin/raptiformica_spawn.py --verbose)"
          },
          "ensure_third_node": {
            "predicate": "[ $(/usr/bin/consul members | grep alive | wc -l) -lt 3 ]",
            "command": "export PYTHONPATH=.; ./bin/raptiformica_spawn --check-available && ([ ! -f $HOME/.ssh/id_rsa ] && cat /dev/zero | ssh-keygen -q -N '' > /dev/null 2>&1; eval $(ssh-agent -s); ssh-add; ./bin/raptiformica_spawn.py --verbose)"
          }
        },
        "cluster_change": {
          "rejoin_peers": {
            "predicate": "/usr/bin/consul members",
            "command": "export PYTHONPATH=.; ./bin/raptiformica_members.py --rejoin --verbose"
          }
        }
      }
    }
  }
}

